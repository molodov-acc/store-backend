# üìû –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Å–∏—Å—Ç–µ–º–µ —á–∞—Ç–∞ (Socket.IO)

## üéØ –ß—Ç–æ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å

–£ –≤–∞—Å —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ **–±–∞–∑–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —á–∞—Ç–∞** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Socket.IO –¥–ª—è —Å–≤—è–∑–∏ –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏. –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
src/sockets/
‚îú‚îÄ‚îÄ constants/          # –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ index.js       # –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –∫–æ–Ω—Å—Ç–∞–Ω—Ç
‚îÇ   ‚îú‚îÄ‚îÄ roles.js       # –†–æ–ª–∏: CLIENT, OPERATOR, SYSTEM
‚îÇ   ‚îú‚îÄ‚îÄ rooms.js       # –ö–æ–º–Ω–∞—Ç—ã: OPERATORS
‚îÇ   ‚îú‚îÄ‚îÄ socketEvents.js # –í—Å–µ —Å–æ–±—ã—Ç–∏—è Socket.IO
‚îÇ   ‚îî‚îÄ‚îÄ statuses.js    # –°—Ç–∞—Ç—É—Å—ã —á–∞—Ç–∞: WAITING, ACTIVE, CLOSED
‚îú‚îÄ‚îÄ middlewares/
‚îÇ   ‚îî‚îÄ‚îÄ auth.js        # Middleware –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ socket.js          # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —á–∞—Ç–∞
```

## üîë –ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

### 1. **–†–æ–ª–∏ (Roles)**
- `CLIENT` - –æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—á–µ—Ç –∑–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å
- `OPERATOR` - –æ–ø–µ—Ä–∞—Ç–æ—Ä –ø–æ–¥–¥–µ—Ä–∂–∫–∏, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã
- `SYSTEM` - —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

### 2. **–°—Ç–∞—Ç—É—Å—ã —á–∞—Ç–∞ (Statuses)**
- `WAITING` - –∫–ª–∏–µ–Ω—Ç –∂–¥–µ—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞
- `ACTIVE` - –æ–ø–µ—Ä–∞—Ç–æ—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω, –∏–¥–µ—Ç –¥–∏–∞–ª–æ–≥
- `CLOSED` - —á–∞—Ç –∑–∞–∫—Ä—ã—Ç

### 3. **–ö–æ–º–Ω–∞—Ç—ã (Rooms)**
- `operators` - —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞ –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ (–¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –Ω–æ–≤—ã—Ö —á–∞—Ç–∞—Ö)

## üîÑ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ö–ª–∏–µ–Ω—Ç –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è

1. –ö–ª–∏–µ–Ω—Ç –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ Socket.IO —Å –¥–∞–Ω–Ω—ã–º–∏:
   ```javascript
   {
     userId: "user123",
     role: "client"
   }
   ```

2. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
   - –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π —á–∞—Ç —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º ID (`chat-user123-timestamp`)
   - –î–æ–±–∞–≤–ª—è–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞ –≤ –∫–æ–º–Ω–∞—Ç—É —ç—Ç–æ–≥–æ —á–∞—Ç–∞
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å `WAITING`
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–ª–∏–µ–Ω—Ç—É —Å–æ–±—ã—Ç–∏–µ `chat:init` —Å `chatId`
   - –£–≤–µ–¥–æ–º–ª—è–µ—Ç –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –æ –Ω–æ–≤–æ–º —á–∞—Ç–µ (`chat:new`)

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –û–ø–µ—Ä–∞—Ç–æ—Ä –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è

1. –û–ø–µ—Ä–∞—Ç–æ—Ä –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è —Å –¥–∞–Ω–Ω—ã–º–∏:
   ```javascript
   {
     userId: "operator456",
     role: "operator"
   }
   ```

2. –°–∏—Å—Ç–µ–º–∞:
   - –î–æ–±–∞–≤–ª—è–µ—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ –≤ –∫–æ–º–Ω–∞—Ç—É `operators`
   - –û–ø–µ—Ä–∞—Ç–æ—Ä –≤–∏–¥–∏—Ç —Å–ø–∏—Å–æ–∫ –æ–∂–∏–¥–∞—é—â–∏—Ö —á–∞—Ç–æ–≤
   - –û–ø–µ—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å —á–∞—Ç –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –Ω–µ–º—É

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –û–ø–µ—Ä–∞—Ç–æ—Ä –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —á–∞—Ç—É

1. –û–ø–µ—Ä–∞—Ç–æ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ:
   ```javascript
   socket.emit("operator:join-chat", { chatId: "chat-user123-1234567890" })
   ```

2. –°–∏—Å—Ç–µ–º–∞:
   - –ú–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å —á–∞—Ç–∞ –Ω–∞ `ACTIVE`
   - –î–æ–±–∞–≤–ª—è–µ—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ –≤ –∫–æ–º–Ω–∞—Ç—É —á–∞—Ç–∞
   - –£–≤–µ–¥–æ–º–ª—è–µ—Ç –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤, —á—Ç–æ —á–∞—Ç –∑–∞–Ω—è—Ç
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç –æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –û–±–º–µ–Ω —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏

1. –õ—é–±–æ–π —É—á–∞—Å—Ç–Ω–∏–∫ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ:
   ```javascript
   socket.emit("chat:message:send", {
     chatId: "chat-user123-1234567890",
     text: "–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?"
   })
   ```

2. –°–∏—Å—Ç–µ–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤—Å–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º —á–∞—Ç–∞:
   ```javascript
   {
     chatId: "chat-user123-1234567890",
     sender: "client" –∏–ª–∏ "operator",
     text: "–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?",
     createdAt: 1234567890123
   }
   ```

## üì° –°–æ–±—ã—Ç–∏—è Socket.IO

### –°–æ–±—ã—Ç–∏—è –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞/–æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ (–æ—Ç–ø—Ä–∞–≤–∫–∞):

| –°–æ–±—ã—Ç–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ | –î–∞–Ω–Ω—ã–µ |
|---------|----------|--------|
| `chat:message:send` | –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ | `{ chatId, text }` |
| `operator:join-chat` | –û–ø–µ—Ä–∞—Ç–æ—Ä –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —á–∞—Ç—É | `{ chatId }` |
| `chat:typing:start` | –ù–∞—á–∞–ª–æ –Ω–∞–±–æ—Ä–∞ —Ç–µ–∫—Å—Ç–∞ | `{ chatId }` |
| `chat:typing:stop` | –û–∫–æ–Ω—á–∞–Ω–∏–µ –Ω–∞–±–æ—Ä–∞ —Ç–µ–∫—Å—Ç–∞ | `{ chatId }` |
| `chat:close` | –ó–∞–∫—Ä—ã—Ç—å —á–∞—Ç (—Ç–æ–ª—å–∫–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä) | `{ chatId }` |

### –°–æ–±—ã—Ç–∏—è –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ (–ø–æ–ª—É—á–µ–Ω–∏–µ):

| –°–æ–±—ã—Ç–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ | –î–∞–Ω–Ω—ã–µ |
|---------|----------|--------|
| `chat:init` | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–∞—Ç–∞ (–∫–ª–∏–µ–Ω—Ç) | `{ chatId }` |
| `chat:new` | –ù–æ–≤—ã–π —á–∞—Ç (–æ–ø–µ—Ä–∞—Ç–æ—Ä—ã) | `{ chatId, clientId, status }` |
| `chat:joined` | –û–ø–µ—Ä–∞—Ç–æ—Ä –ø–æ–¥–∫–ª—é—á–∏–ª—Å—è (–æ–ø–µ—Ä–∞—Ç–æ—Ä—ã) | `{ chatId, operatorId, status }` |
| `chat:updated` | –°—Ç–∞—Ç—É—Å —á–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω (–æ–ø–µ—Ä–∞—Ç–æ—Ä—ã) | `{ chatId, status }` |
| `chat:closed` | –ß–∞—Ç –∑–∞–∫—Ä—ã—Ç (–æ–ø–µ—Ä–∞—Ç–æ—Ä—ã) | `{ chatId }` |
| `chat:message:new` | –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ | `{ chatId, sender, text, createdAt }` |
| `chat:typing:start` | –ö—Ç–æ-—Ç–æ –ø–µ—á–∞—Ç–∞–µ—Ç | `{ role, userId }` |
| `chat:typing:stop` | –ö—Ç–æ-—Ç–æ –ø–µ—Ä–µ—Å—Ç–∞–ª –ø–µ—á–∞—Ç–∞—Ç—å | `{ role, userId }` |

## üíª –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞

```javascript
import io from 'socket.io-client';

const socket = io('http://localhost:3000', {
  auth: {
    userId: 'user123',
    role: 'client'
  }
});

let chatId = null;

// –ü–æ–ª—É—á–∞–µ–º chatId –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏
socket.on('chat:init', (data) => {
  chatId = data.chatId;
  console.log('–ß–∞—Ç —Å–æ–∑–¥–∞–Ω:', chatId);
});

// –ü–æ–ª—É—á–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
socket.on('chat:message:new', (message) => {
  console.log('–ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:', message);
  // –î–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ UI
});

// –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
function sendMessage(text) {
  socket.emit('chat:message:send', {
    chatId: chatId,
    text: text
  });
}

// –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–∞–±–æ—Ä–∞ —Ç–µ–∫—Å—Ç–∞
let typingTimeout;
function onTyping() {
  socket.emit('chat:typing:start', { chatId });
  
  clearTimeout(typingTimeout);
  typingTimeout = setTimeout(() => {
    socket.emit('chat:typing:stop', { chatId });
  }, 1000);
}
```

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞

```javascript
import io from 'socket.io-client';

const socket = io('http://localhost:3000', {
  auth: {
    userId: 'operator456',
    role: 'operator'
  }
});

// –°–ø–∏—Å–æ–∫ –æ–∂–∏–¥–∞—é—â–∏—Ö —á–∞—Ç–æ–≤
const waitingChats = [];

socket.on('chat:new', (data) => {
  waitingChats.push(data);
  console.log('–ù–æ–≤—ã–π —á–∞—Ç:', data);
  // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—É
});

socket.on('chat:joined', (data) => {
  console.log('–û–ø–µ—Ä–∞—Ç–æ—Ä –ø–æ–¥–∫–ª—é—á–∏–ª—Å—è –∫ —á–∞—Ç—É:', data);
  // –£–±—Ä–∞—Ç—å —á–∞—Ç –∏–∑ —Å–ø–∏—Å–∫–∞ –æ–∂–∏–¥–∞—é—â–∏—Ö
});

socket.on('chat:closed', (data) => {
  console.log('–ß–∞—Ç –∑–∞–∫—Ä—ã—Ç:', data.chatId);
  // –£–±—Ä–∞—Ç—å —á–∞—Ç –∏–∑ —Å–ø–∏—Å–∫–∞
});

// –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —á–∞—Ç—É
function joinChat(chatId) {
  socket.emit('operator:join-chat', { chatId });
}

// –ó–∞–∫—Ä—ã—Ç—å —á–∞—Ç
function closeChat(chatId) {
  socket.emit('chat:close', { chatId });
}
```

## üöÄ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ

### 1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã)

```bash
npm install socket.io socket.io-client
```

### 2. **–°–æ–∑–¥–∞—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**

–í–∞–º –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –¥–≤–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:
- **–ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π —á–∞—Ç** - –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–ü–∞–Ω–µ–ª—å –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞** - –¥–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –ø–æ–¥–¥–µ—Ä–∂–∫–∏

### 3. **–£–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)**

- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –§–∞–π–ª—ã –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ —á–∞—Ç–µ
- ‚úÖ –û—á–µ—Ä–µ–¥—å —á–∞—Ç–æ–≤ (–∫—Ç–æ –ø–µ—Ä–≤—ã–π –≤ –æ—á–µ—Ä–µ–¥–∏)
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —á–∞—Ç–æ–≤ –º–µ–∂–¥—É –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏
- ‚úÖ –û—Ü–µ–Ω–∫–∞ —Ä–∞–±–æ—Ç—ã –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ –∫–ª–∏–µ–Ω—Ç–æ–º

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ—Å—Ç—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é —á–µ—Ä–µ–∑ `handshake.auth`. –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:

1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å JWT —Ç–æ–∫–µ–Ω—ã
2. –ü—Ä–æ–≤–µ—Ä—è—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
3. –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –≤—Ö–æ–¥—è—â–∏–µ –¥–∞–Ω–Ω—ã–µ
4. –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å —á–∞—Å—Ç–æ—Ç—É –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π

## üìù –ü—Ä–∏–º–µ—Ä —É–ª—É—á—à–µ–Ω–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

```javascript
// middlewares/auth.js
const jwt = require('jsonwebtoken');

function auth(socket, next) {
  const token = socket.handshake.auth.token;
  
  if (!token) {
    return next(new Error('–¢—Ä–µ–±—É–µ—Ç—Å—è —Ç–æ–∫–µ–Ω'));
  }
  
  try {
    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    socket.userId = decoded.userId;
    socket.role = decoded.role;
    next();
  } catch (error) {
    next(new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω'));
  }
}
```

## üé® –ü—Ä–∏–º–µ—Ä UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ (React)

```jsx
import { useState, useEffect } from 'react';
import io from 'socket.io-client';

function ChatWidget({ userId }) {
  const [socket, setSocket] = useState(null);
  const [messages, setMessages] = useState([]);
  const [chatId, setChatId] = useState(null);
  const [inputText, setInputText] = useState('');

  useEffect(() => {
    const newSocket = io('http://localhost:3000', {
      auth: { userId, role: 'client' }
    });

    newSocket.on('chat:init', (data) => {
      setChatId(data.chatId);
    });

    newSocket.on('chat:message:new', (message) => {
      setMessages(prev => [...prev, message]);
    });

    setSocket(newSocket);

    return () => newSocket.close();
  }, [userId]);

  const sendMessage = () => {
    if (socket && chatId && inputText.trim()) {
      socket.emit('chat:message:send', {
        chatId,
        text: inputText
      });
      setInputText('');
    }
  };

  return (
    <div className="chat-widget">
      <div className="messages">
        {messages.map((msg, i) => (
          <div key={i} className={`message ${msg.sender}`}>
            <strong>{msg.sender}:</strong> {msg.text}
          </div>
        ))}
      </div>
      <div className="input-area">
        <input
          value={inputText}
          onChange={(e) => setInputText(e.target.value)}
          onKeyPress={(e) => e.key === 'Enter' && sendMessage()}
          placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."
        />
        <button onClick={sendMessage}>–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      </div>
    </div>
  );
}
```

## ‚ùì –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã

**Q: –ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è?**  
A: –°–µ–π—á–∞—Å —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è. –û–Ω–∏ —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. –î–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.

**Q: –ö–∞–∫ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤?**  
A: –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤ `socket.js` –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞.

**Q: –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª—ã –≤ —á–∞—Ç?**  
A: –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ multer –∏ –æ—Ç–ø—Ä–∞–≤–∫—É —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ.

**Q: –ö–∞–∫ —Å–¥–µ–ª–∞—Ç—å –æ—á–µ—Ä–µ–¥—å —á–∞—Ç–æ–≤?**  
A: –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞—Å—Å–∏–≤ –≤–º–µ—Å—Ç–æ Map –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —á–∞—Ç—ã –ø–æ –ø–æ—Ä—è–¥–∫—É.

---

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üéâ –°–∏—Å—Ç–µ–º–∞ —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.

